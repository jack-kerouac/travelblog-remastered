{{ define "main" }}
<article class="post">
  <header>
    <h1>{{ .Title }}</h1>
    <div class="post-meta">
      <time datetime="{{ .Date.Format "2006-01-02" }}">
        {{ .Date.Format "January 2, 2006" }}
      </time>
      {{ with .Params.location }}
        <span class="location">üìç {{ delimit . " > " }}</span>
      {{ end }}
      {{ with .Params.trip }}
        {{ with $.Site.GetPage (printf "/trips/%s" .) }}
          <span class="trip-link">
            üó∫Ô∏è <a href="{{ .Permalink }}">{{ .Title }}</a>
          </span>
        {{ end }}
      {{ end }}
    </div>

    {{ with .Params.countries }}
      <div class="post-countries">
        {{ range . }}
          <span class="country-tag">{{ . }}</span>
        {{ end }}
      </div>
    {{ end }}

    {{ with .Params.tags }}
      <div class="post-tags">
        {{ range . }}
          <a href="{{ "/tags/" | relURL }}{{ . | urlize }}" class="tag">{{ . }}</a>
        {{ end }}
      </div>
    {{ end }}
  </header>

  <div class="post-content">
    {{ .Content }}
  </div>

  {{ with .Params.images }}
    <div class="post-images">
      {{ range . }}
        <figure class="post-image">
          {{ $image := . }}
          <img src="/images/{{ $.Params.trip_slug }}/{{ $.File.ContentBaseName }}/{{ .filename }}"
               alt="{{ with .title }}{{ . }}{{ else }}{{ .filename }}{{ end }}"
               loading="lazy">
          {{ if or .title .description }}
            <figcaption>
              {{ with .title }}<strong>{{ . }}</strong>{{ end }}
              {{ with .description }}
                {{ if $image.title }}<br>{{ end }}
                {{ . }}
              {{ end }}
            </figcaption>
          {{ end }}
        </figure>
      {{ end }}
    </div>
  {{ end }}

  <footer class="post-footer">
    {{ with .Params.trip }}
      {{ with $.Site.GetPage (printf "/trips/%s" .) }}
        <div class="trip-context">
          <p>This post is part of <a href="{{ .Permalink }}">{{ .Title }}</a></p>
        </div>
      {{ end }}
    {{ end }}

    <div class="post-navigation">
      {{ with .NextInSection }}
        <a href="{{ .Permalink }}" class="prev-post">‚Üê {{ .Title }}</a>
      {{ end }}
      {{ with .PrevInSection }}
        <a href="{{ .Permalink }}" class="next-post">{{ .Title }} ‚Üí</a>
      {{ end }}
    </div>
  </footer>
</article>
{{ end }}
